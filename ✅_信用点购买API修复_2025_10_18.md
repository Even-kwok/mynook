# âœ… ä¿¡ç”¨ç‚¹è´­ä¹° API CREEM å‚æ•°ä¿®å¤å®Œæˆ

**ä¿®å¤æ—¶é—´**: 2025-10-18  
**åˆ†æ”¯**: public-beta  
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ› é—®é¢˜æè¿°

ä¿¡ç”¨ç‚¹è´­ä¹°æŒ‰é’®ç‚¹å‡»åï¼ŒCREEM API è¿”å› 403 Forbidden é”™è¯¯ã€‚

**é”™è¯¯æ—¥å¿—**:
```
âŒ CREEM API error: {
  status: 403,
  error: 'Forbidden',
  timestamp: 1760768392653
}
```

**æ ¹æœ¬åŸå› **ï¼š
ä¿¡ç”¨ç‚¹è´­ä¹° API (`api/purchase-credits.js`) ä½¿ç”¨äº†é”™è¯¯çš„å‚æ•°æ ¼å¼ï¼Œè€Œè®¢é˜… API å·²ç»ä¿®å¤è¿‡äº†ã€‚

---

## âœ… ä¿®å¤å†…å®¹

### 1ï¸âƒ£ **ç§»é™¤ `cancel_url` å‚æ•°**

```javascript
// âŒ ä¿®å¤å‰
const creemPayload = {
  product_id: pack.productId,
  success_url: successUrl,
  cancel_url: cancelUrl,  // âŒ CREEM ä¸æ”¯æŒæ­¤å‚æ•°
  // ...
};
```

```javascript
// âœ… ä¿®å¤å
const creemPayload = {
  product_id: pack.productId,
  success_url: successUrl,
  // âœ… ç§»é™¤äº† cancel_url
  // ...
};
```

---

### 2ï¸âƒ£ **å°† `custom_field` æ”¹ä¸º `metadata`**

```javascript
// âŒ ä¿®å¤å‰
custom_field: {
  type: 'credits',
  pack_type: packType,
  // ...
}
```

```javascript
// âœ… ä¿®å¤å
metadata: {
  type: 'credits',
  pack_type: packType,
  // ...
}
```

---

### 3ï¸âƒ£ **ä½¿ç”¨æ­£ç¡®çš„è®¤è¯æ–¹å¼**

```javascript
// âŒ ä¿®å¤å‰
headers: {
  'Authorization': `Bearer ${creemApiKey}`,
  'Content-Type': 'application/json',
}
```

```javascript
// âœ… ä¿®å¤å
headers: {
  'x-api-key': creemApiKey,
  'Content-Type': 'application/json',
}
```

---

### 4ï¸âƒ£ **å¢å¼º Checkout URL æ£€æµ‹**

```javascript
// âœ… æ”¯æŒå¤šç§å¯èƒ½çš„ URL å­—æ®µå
const checkoutUrl = session.url 
  || session.checkout_url 
  || session.payment_url 
  || session.link;

if (!checkoutUrl) {
  throw new Error('No checkout URL in CREEM response');
}
```

---

### 5ï¸âƒ£ **æ·»åŠ è¯¦ç»†è°ƒè¯•æ—¥å¿—**

```javascript
console.log('========== CREEM API Response ==========');
console.log('ğŸ” Full Response:', JSON.stringify(session, null, 2));
console.log('ğŸ” Response Keys:', Object.keys(session));
console.log('ğŸ” session.url:', session.url);
console.log('ğŸ” session.checkout_url:', session.checkout_url);
console.log('ğŸ” session.payment_url:', session.payment_url);
console.log('========================================');
```

---

## ğŸ“Š ä¿®æ”¹å¯¹æ¯”

| é¡¹ç›® | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| **è®¤è¯æ–¹å¼** | `Authorization: Bearer` | `x-api-key` |
| **æˆåŠŸ URL** | åŒ…å« `cancel_url` | ä»… `success_url` |
| **è‡ªå®šä¹‰æ•°æ®** | `custom_field` | `metadata` |
| **URL æ£€æµ‹** | ä»… `session.url` | æ”¯æŒå¤šç§å­—æ®µå |
| **è°ƒè¯•æ—¥å¿—** | åŸºç¡€ | è¯¦ç»†çš„å“åº”è°ƒè¯• |

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|---------|
| `api/purchase-credits.js` | åº”ç”¨ä¸è®¢é˜… API ç›¸åŒçš„ CREEM å‚æ•°ä¿®å¤ |

---

## ğŸ“‹ æµ‹è¯•æ¸…å•

è¯·åœ¨ Vercel é¢„è§ˆç¯å¢ƒæµ‹è¯•ï¼š

### **1. ä¿¡ç”¨ç‚¹è´­ä¹°æµç¨‹**
- [ ] ç‚¹å‡»ä»»ä¸€ä¿¡ç”¨ç‚¹è´­ä¹°æŒ‰é’®ï¼ˆ100/300/1000ï¼‰
- [ ] åº”è¯¥æˆåŠŸè·³è½¬åˆ° CREEM æ”¯ä»˜é¡µé¢
- [ ] Vercel Logs ä¸åº”å†æœ‰ 403 é”™è¯¯

### **2. è®¢é˜…æµç¨‹ï¼ˆå›å½’æµ‹è¯•ï¼‰**
- [ ] ç‚¹å‡»è®¢é˜…æŒ‰é’®
- [ ] åº”è¯¥æˆåŠŸè·³è½¬åˆ° CREEM æ”¯ä»˜é¡µé¢
- [ ] ä¸åº”å—åˆ°æœ¬æ¬¡ä¿®æ”¹çš„å½±å“

### **3. æ£€æŸ¥ Vercel Logs**
- [ ] ä¿¡ç”¨ç‚¹è´­ä¹°ï¼šç¡®è®¤æ—  403/400 é”™è¯¯
- [ ] è®¢é˜…ï¼šç¡®è®¤ä¾ç„¶æ­£å¸¸å·¥ä½œ
- [ ] æŸ¥çœ‹è¯¦ç»†çš„ CREEM API å“åº”æ—¥å¿—

---

## ğŸ“Š éƒ¨ç½²çŠ¶æ€

- âœ… ä»£ç å·²æäº¤åˆ° `public-beta` åˆ†æ”¯
- âœ… å·²æ¨é€åˆ° GitHub
- â³ ç­‰å¾… Vercel è‡ªåŠ¨éƒ¨ç½²

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **ç­‰å¾… Vercel éƒ¨ç½²å®Œæˆ**ï¼ˆçº¦ 1-2 åˆ†é’Ÿï¼‰
2. **æµ‹è¯•ä¿¡ç”¨ç‚¹è´­ä¹°æµç¨‹**
3. **å›å½’æµ‹è¯•è®¢é˜…æµç¨‹**
4. **éªŒè¯ä¸¤ä¸ªæµç¨‹éƒ½èƒ½æˆåŠŸè·³è½¬åˆ° CREEM æ”¯ä»˜é¡µé¢**

---

## ğŸ’¡ ç»éªŒæ€»ç»“

### **ä¿æŒ API ä¸€è‡´æ€§**
- è®¢é˜… API å’Œä¿¡ç”¨ç‚¹è´­ä¹° API ä½¿ç”¨ç›¸åŒçš„ CREEM é›†æˆæ–¹å¼
- ä¿®å¤ä¸€ä¸ªæ—¶è¦æ£€æŸ¥å…¶ä»–ç±»ä¼¼çš„ API
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œè°ƒè¯•æ—¥å¿—

### **CREEM API é›†æˆè¦ç‚¹**
1. âœ… ä½¿ç”¨ `x-api-key` è®¤è¯ï¼ˆä¸æ˜¯ Bearer Tokenï¼‰
2. âœ… åªä½¿ç”¨ `success_url`ï¼ˆä¸è¦ `cancel_url`ï¼‰
3. âœ… ä½¿ç”¨ `metadata`ï¼ˆä¸æ˜¯ `custom_field`ï¼‰
4. âœ… æ”¯æŒå¤šç§å¯èƒ½çš„ URL å­—æ®µå

---

**çŠ¶æ€**: âœ… ä¿®å¤å®Œæˆï¼Œå¾…æµ‹è¯•éªŒè¯

