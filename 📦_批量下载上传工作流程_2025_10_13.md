# ğŸ“¦ æ‰¹é‡ä¸‹è½½ä¸ä¸Šä¼ å·¥ä½œæµç¨‹

**åˆ›å»ºæ—¶é—´**: 2025å¹´10æœˆ13æ—¥  
**åŠŸèƒ½**: æ‰¹é‡ä¸‹è½½ç”Ÿæˆçš„å›¾ç‰‡å¹¶ä¸Šä¼ åˆ° Supabase æ¨¡æ¿ç¼©ç•¥å›¾æ•°æ®åº“

---

## ğŸ¯ å·¥ä½œæµç¨‹æ¦‚è¿°

```
1. ç”¨æˆ·åœ¨å‰ç«¯ç”Ÿæˆå›¾ç‰‡
   â†“
2. ç‚¹å‡»"æ‰¹é‡ä¸‹è½½å…¨éƒ¨"æŒ‰é’®
   â†“
3. å›¾ç‰‡è‡ªåŠ¨ä¸‹è½½å¹¶æŒ‰è§„èŒƒå‘½å
   â†“
4. å°†ä¸‹è½½çš„å›¾ç‰‡æ”¾å…¥é¡¹ç›®æ–‡ä»¶å¤¹
   â†“
5. è¿è¡Œæ‰¹é‡ä¸Šä¼ è„šæœ¬
   â†“
6. å›¾ç‰‡è‡ªåŠ¨ä¸Šä¼ å¹¶åˆ†é…åˆ°å¯¹åº”æ¨¡æ¿
```

---

## ğŸ“ æ–‡ä»¶å‘½åè§„èŒƒ

### å‘½åæ ¼å¼
```
{type}_{roomTypeId}_{templateId}_{batchId}_{imageId}.png
```

### å‘½åè§„åˆ™
- æ‰€æœ‰å­—æ¯è½¬å°å†™
- ç©ºæ ¼å’Œç‰¹æ®Šå­—ç¬¦è½¬ä¸ºè¿å­—ç¬¦ `-`
- å„éƒ¨åˆ†ç”¨ä¸‹åˆ’çº¿ `_` è¿æ¥

### ç¤ºä¾‹

#### Interior Design
```
style_living-room_modern-minimalist_1728835200000_modern-minimalist.png
```
è§£æï¼š
- `type`: `style` (Interior Design åŠŸèƒ½)
- `roomTypeId`: `living-room` (Living Room)
- `templateId`: `modern-minimalist` (Modern Minimalist æ¨¡æ¿)
- `batchId`: `1728835200000` (ç”Ÿæˆæ‰¹æ¬¡æ—¶é—´æˆ³)
- `imageId`: `modern-minimalist` (å›¾ç‰‡IDï¼Œé€šå¸¸æ˜¯æ¨¡æ¿åç§°)

#### Exterior Design
```
exterior_house_contemporary_1728835300000_contemporary.png
```
è§£æï¼š
- `type`: `exterior` (Exterior Design åŠŸèƒ½)
- `roomTypeId`: `house` (House å»ºç­‘ç±»å‹)
- `templateId`: `contemporary` (Contemporary æ¨¡æ¿)

#### Garden Design
```
garden_no-room_japanese-zen-garden_1728835400000_japanese-zen-garden.png
```
è§£æï¼š
- `type`: `garden` (Garden Design åŠŸèƒ½)
- `roomTypeId`: `no-room` (Garden æ²¡æœ‰æˆ¿é—´ç±»å‹)
- `templateId`: `japanese-zen-garden`

---

## ğŸ’» å‰ç«¯æ‰¹é‡ä¸‹è½½åŠŸèƒ½

### ä½ç½®
`components/FreeCanvasPage.tsx` - `MyDesignsSidebar` ç»„ä»¶

### åŠŸèƒ½ç‰¹ç‚¹
- âœ… è‡ªåŠ¨æ ¹æ®è·¯å¾„ä¿¡æ¯ç”Ÿæˆæ–‡ä»¶å
- âœ… é€ä¸ªä¸‹è½½ï¼ˆæ¯æ¬¡é—´éš”100msé¿å…æµè§ˆå™¨é˜»æ­¢ï¼‰
- âœ… æ˜¾ç¤ºä¸‹è½½è¿›åº¦
- âœ… åªä¸‹è½½æˆåŠŸç”Ÿæˆçš„å›¾ç‰‡

### ä½¿ç”¨æ–¹æ³•
1. ç”Ÿæˆå›¾ç‰‡å
2. åœ¨å³ä¾§ **My Designs** ä¾§è¾¹æ é¡¶éƒ¨
3. ç‚¹å‡» **"æ‰¹é‡ä¸‹è½½å…¨éƒ¨ (n)"** æŒ‰é’®
4. ç¡®è®¤ä¸‹è½½
5. å›¾ç‰‡ä¼šè‡ªåŠ¨ä¿å­˜åˆ°æµè§ˆå™¨é»˜è®¤ä¸‹è½½æ–‡ä»¶å¤¹

---

## ğŸ“‚ æ–‡ä»¶ç»„ç»‡

### æ¨èçš„é¡¹ç›®æ–‡ä»¶å¤¹ç»“æ„
```
mynook/
â”œâ”€â”€ downloaded-images/          # ä»æµè§ˆå™¨ä¸‹è½½çš„åŸå§‹å›¾ç‰‡
â”‚   â”œâ”€â”€ style_living-room_modern-minimalist_xxx.png
â”‚   â”œâ”€â”€ style_bedroom_scandinavian_xxx.png
â”‚   â”œâ”€â”€ exterior_house_contemporary_xxx.png
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ upload-thumbnails.ts    # æ‰¹é‡ä¸Šä¼ è„šæœ¬
â”‚
â””â”€â”€ public/
    â””â”€â”€ templates/              # æœ€ç»ˆçš„ç¼©ç•¥å›¾å­˜å‚¨ä½ç½®ï¼ˆå¯é€‰ï¼‰
```

---

## ğŸš€ Supabase æ‰¹é‡ä¸Šä¼ è„šæœ¬

### è„šæœ¬ä½ç½®
`scripts/upload-thumbnails.ts`

### åŠŸèƒ½
1. è¯»å– `downloaded-images/` æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰å›¾ç‰‡
2. è§£ææ–‡ä»¶åè·å–å…ƒæ•°æ®
3. ä¸Šä¼ åˆ° Supabase Storage
4. æ›´æ–° `templates` è¡¨çš„ `imageUrl` å­—æ®µ

### ä½¿ç”¨æ–¹æ³•
```bash
# 1. å°†ä¸‹è½½çš„å›¾ç‰‡æ”¾å…¥ downloaded-images æ–‡ä»¶å¤¹
# 2. è¿è¡Œä¸Šä¼ è„šæœ¬
npx tsx scripts/upload-thumbnails.ts

# æˆ–ä½¿ç”¨ Node
node scripts/upload-thumbnails.ts
```

---

## ğŸ—„ï¸ æ•°æ®åº“è¡¨ç»“æ„

### templates è¡¨
```sql
-- å¦‚æœè¿˜æ²¡æœ‰ imageUrl å­—æ®µï¼Œéœ€è¦æ·»åŠ 
ALTER TABLE templates 
ADD COLUMN IF NOT EXISTS imageUrl TEXT;

-- æŸ¥çœ‹ç°æœ‰å­—æ®µ
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'templates';
```

### å­—æ®µè¯´æ˜
- `id`: æ¨¡æ¿å”¯ä¸€æ ‡è¯†ç¬¦ (UUID)
- `name`: æ¨¡æ¿åç§°
- `prompt`: æ¨¡æ¿æç¤ºè¯
- `category`: æ¨¡æ¿åˆ†ç±»
- `room_type`: æˆ¿é—´ç±»å‹
- `imageUrl`: ç¼©ç•¥å›¾ URL (å°†ç”±ä¸Šä¼ è„šæœ¬å¡«å……)

---

## ğŸ“Š æ–‡ä»¶åè§£æé€»è¾‘

### JavaScript/TypeScript ç¤ºä¾‹
```typescript
function parseFileName(fileName: string) {
    // ç§»é™¤æ‰©å±•å
    const baseName = fileName.replace(/\\.png$/, '');
    
    // æŒ‰ä¸‹åˆ’çº¿åˆ†å‰²
    const parts = baseName.split('_');
    
    if (parts.length < 5) {
        console.warn(`Invalid file name format: ${fileName}`);
        return null;
    }
    
    return {
        type: parts[0],           // 'style', 'exterior', 'garden', etc.
        roomTypeId: parts[1],     // 'living-room', 'house', 'no-room'
        templateId: parts[2],     // 'modern-minimalist', 'contemporary'
        batchId: parts[3],        // æ—¶é—´æˆ³
        imageId: parts[4],        // å›¾ç‰‡ID
        originalName: fileName
    };
}

// ä½¿ç”¨ç¤ºä¾‹
const parsed = parseFileName('style_living-room_modern-minimalist_1728835200000_modern-minimalist.png');
console.log(parsed);
// {
//   type: 'style',
//   roomTypeId: 'living-room',
//   templateId: 'modern-minimalist',
//   batchId: '1728835200000',
//   imageId: 'modern-minimalist',
//   originalName: 'style_living-room_modern-minimalist_1728835200000_modern-minimalist.png'
// }
```

---

## ğŸ”„ ä¸Šä¼ æµç¨‹

### 1. å‡†å¤‡é˜¶æ®µ
```bash
# åˆ›å»ºå­˜æ”¾ä¸‹è½½å›¾ç‰‡çš„æ–‡ä»¶å¤¹
mkdir downloaded-images
cd downloaded-images
```

### 2. å‰ç«¯ä¸‹è½½
- åœ¨æµè§ˆå™¨ä¸­ç”Ÿæˆå›¾ç‰‡
- ç‚¹å‡»"æ‰¹é‡ä¸‹è½½å…¨éƒ¨"
- å°†ä¸‹è½½çš„å›¾ç‰‡ç§»åŠ¨åˆ° `downloaded-images/` æ–‡ä»¶å¤¹

### 3. éªŒè¯æ–‡ä»¶å
```bash
# æŸ¥çœ‹ä¸‹è½½çš„æ–‡ä»¶
ls downloaded-images/

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„æ–‡ä»¶ï¼š
# style_living-room_modern-minimalist_1728835200000_modern-minimalist.png
# style_bedroom_scandinavian_1728835201000_scandinavian.png
```

### 4. è¿è¡Œä¸Šä¼ è„šæœ¬
```bash
# ä½¿ç”¨ Cursor + MCP è¿è¡Œ
npx tsx scripts/upload-thumbnails.ts
```

### 5. éªŒè¯ä¸Šä¼ ç»“æœ
```sql
-- åœ¨ Supabase SQL Editor ä¸­æ£€æŸ¥
SELECT id, name, imageUrl 
FROM templates 
WHERE imageUrl IS NOT NULL
ORDER BY updated_at DESC
LIMIT 10;
```

---

## âœ… æµ‹è¯•æ¸…å•

### ä¸‹è½½åŠŸèƒ½æµ‹è¯•
- [ ] ç”Ÿæˆå¤šå¼ å›¾ç‰‡ï¼ˆä¸åŒåŠŸèƒ½ã€æˆ¿é—´ç±»å‹ã€æ¨¡æ¿ï¼‰
- [ ] ç‚¹å‡»"æ‰¹é‡ä¸‹è½½å…¨éƒ¨"æŒ‰é’®
- [ ] æ£€æŸ¥æµè§ˆå™¨ä¸‹è½½æ–‡ä»¶å¤¹
- [ ] éªŒè¯æ–‡ä»¶åæ ¼å¼æ­£ç¡®
- [ ] éªŒè¯æ‰€æœ‰å›¾ç‰‡éƒ½å·²ä¸‹è½½

### æ–‡ä»¶åéªŒè¯
- [ ] æ–‡ä»¶ååŒ…å«æ‰€æœ‰å¿…è¦ä¿¡æ¯
- [ ] æ ¼å¼ç¬¦åˆè§„èŒƒï¼ˆå°å†™ã€è¿å­—ç¬¦ã€ä¸‹åˆ’çº¿ï¼‰
- [ ] å¯ä»¥æ­£ç¡®è§£æå‡ºå…ƒæ•°æ®

### ä¸Šä¼ è„šæœ¬æµ‹è¯•
- [ ] è„šæœ¬èƒ½æ­£ç¡®è¯»å–æ–‡ä»¶å¤¹
- [ ] æ–‡ä»¶åè§£ææ­£ç¡®
- [ ] ä¸Šä¼ åˆ° Supabase Storage æˆåŠŸ
- [ ] æ•°æ®åº“è®°å½•æ›´æ–°æ­£ç¡®
- [ ] ç¼©ç•¥å›¾ URL å¯è®¿é—®

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: æµè§ˆå™¨é˜»æ­¢äº†æ‰¹é‡ä¸‹è½½ï¼Ÿ
**A**: ç°ä»£æµè§ˆå™¨ä¼šé˜»æ­¢è¿‡äºé¢‘ç¹çš„ä¸‹è½½ã€‚è§£å†³æ–¹æ¡ˆï¼š
- æˆ‘ä»¬å·²ç»æ·»åŠ äº†100msçš„å»¶è¿Ÿ
- å¦‚æœä»è¢«é˜»æ­¢ï¼Œè¯·åœ¨æµè§ˆå™¨è®¾ç½®ä¸­å…è®¸å¤šæ¬¡ä¸‹è½½
- Chrome: è®¾ç½® â†’ éšç§å’Œå®‰å…¨ â†’ ç½‘ç«™è®¾ç½® â†’ è‡ªåŠ¨ä¸‹è½½

### Q2: æ–‡ä»¶åä¸­æœ‰ä¹±ç ï¼Ÿ
**A**: ç¡®ä¿æ¨¡æ¿IDå’Œåç§°åªåŒ…å«è‹±æ–‡å­—æ¯å’Œæ•°å­—ã€‚ä¸­æ–‡ä¼šè¢«è½¬æ¢ä¸ºè¿å­—ç¬¦ã€‚

### Q3: ä¸Šä¼ åˆ°å“ªä¸ª Storage Bucketï¼Ÿ
**A**: å»ºè®®ä½¿ç”¨ï¼š
- Bucket åç§°: `template-thumbnails`
- å…¬å¼€è®¿é—®: `true`
- è·¯å¾„: `/{type}/{roomTypeId}/{templateId}.png`

### Q4: å¦‚ä½•æ‰¹é‡æ›´æ–°å·²æœ‰æ¨¡æ¿çš„ç¼©ç•¥å›¾ï¼Ÿ
**A**: ä¸Šä¼ è„šæœ¬ä¼šæ ¹æ® `templateId` åŒ¹é…ç°æœ‰æ¨¡æ¿å¹¶æ›´æ–° `imageUrl`

---

## ğŸ“ˆ åç»­ä¼˜åŒ–

### å¯èƒ½çš„æ”¹è¿›
1. **ZIP æ‰“åŒ…ä¸‹è½½**
   - å®‰è£… `jszip` åº“
   - å°†æ‰€æœ‰å›¾ç‰‡æ‰“åŒ…æˆä¸€ä¸ª ZIP æ–‡ä»¶
   - ä¸€æ¬¡æ€§ä¸‹è½½

2. **äº‘ç«¯åŒæ­¥**
   - ç›´æ¥ä»å‰ç«¯ä¸Šä¼ åˆ° Supabase Storage
   - ä¸éœ€è¦æœ¬åœ°ä¸‹è½½-ä¸Šä¼ æµç¨‹
   - éœ€è¦è€ƒè™‘å®‰å…¨æ€§å’Œæƒé™

3. **å…ƒæ•°æ®å¯¼å‡º**
   - åŒæ—¶å¯¼å‡ºä¸€ä¸ª `metadata.json` æ–‡ä»¶
   - åŒ…å«æ‰€æœ‰å›¾ç‰‡çš„è¯¦ç»†ä¿¡æ¯
   - ä¾¿äºåç»­å¤„ç†

4. **è‡ªåŠ¨åŒ–è„šæœ¬**
   - ç›‘å¬æ–‡ä»¶å¤¹å˜åŒ–
   - æ–°æ–‡ä»¶è‡ªåŠ¨ä¸Šä¼ 
   - å®æ—¶æ›´æ–°æ•°æ®åº“

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ–‡ä»¶å¤§å°**: ç¡®ä¿å›¾ç‰‡å·²å‹ç¼©ï¼Œå»ºè®®å•å¼ ä¸è¶…è¿‡ 500KB
2. **å‘½åå†²çª**: å¦‚æœåŒä¸€æ¨¡æ¿ç”Ÿæˆå¤šæ¬¡ï¼Œæ–‡ä»¶åä¼šåŒ…å«ä¸åŒçš„ batchId
3. **æƒé™**: è¿è¡Œä¸Šä¼ è„šæœ¬éœ€è¦ Supabase ç®¡ç†å‘˜æƒé™
4. **å¤‡ä»½**: ä¸Šä¼ å‰å»ºè®®å¤‡ä»½ç°æœ‰çš„æ¨¡æ¿æ•°æ®

---

## ğŸ‰ å®Œæˆï¼

ç°åœ¨ä½ æœ‰äº†ä¸€ä¸ªå®Œæ•´çš„æ‰¹é‡ä¸‹è½½å’Œä¸Šä¼ å·¥ä½œæµç¨‹ï¼

**ä¸‹ä¸€æ­¥**:
1. æµ‹è¯•æ‰¹é‡ä¸‹è½½åŠŸèƒ½
2. åˆ›å»ºå¹¶è¿è¡Œä¸Šä¼ è„šæœ¬
3. éªŒè¯ç¼©ç•¥å›¾æ˜¾ç¤ºæ­£ç¡®

