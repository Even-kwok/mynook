# 🚀 测试上传缩略图 - 快速指南

**日期**: 2025年10月13日  
**文件位置**: `upload/` 文件夹  
**目标**: 上传3张图片到 Supabase 作为模板缩略图

---

## 📋 文件清单

你的 `upload/` 文件夹中有3个文件：

1. **Latte___Creamy_Style_Living_Room_1760359717742.png** (2.1 MB)
   - 模板: Latte / Creamy Style Living Room
   - ID: `1df50169-533c-4745-9157-902b9e55ffe8`

2. **style_living-room_latte-creamy-style-living-room_1760360118928.png** (2.0 MB)
   - 模板: Latte / Creamy Style Living Room
   - ID: `1df50169-533c-4745-9157-902b9e55ffe8`

3. **style_living-room_organic-modern-living-room_1760360118928.png** (2.4 MB)
   - 模板: Organic Modern Living Room
   - ID: `18f2c806-f0f5-435c-acea-e3036c6a16ac`

---

## 🔧 上传步骤

### 步骤1：获取 Supabase 配置

1. 打开 https://supabase.com/dashboard
2. 进入你的项目
3. 点击左侧 **Settings** (齿轮图标)
4. 点击 **API**
5. 复制以下信息：
   - **Project URL** (例如: `https://xxxxx.supabase.co`)
   - **service_role key** (点击眼睛图标查看)

### 步骤2：创建 Storage Bucket（如果还没有）

在 Supabase Dashboard:
1. 点击左侧 **Storage**
2. 如果没有 `template-thumbnails` bucket，点击 **New Bucket**
3. 名称: `template-thumbnails`
4. 公开访问: ✅ 勾选 Public
5. 点击 **Create**

或在 SQL Editor 执行：
```sql
-- 创建 bucket
INSERT INTO storage.buckets (id, name, public)
VALUES ('template-thumbnails', 'template-thumbnails', true)
ON CONFLICT (id) DO NOTHING;

-- 设置公开访问策略
CREATE POLICY IF NOT EXISTS "Public Access"
ON storage.objects FOR SELECT
USING ( bucket_id = 'template-thumbnails' );

-- 允许服务密钥上传
CREATE POLICY IF NOT EXISTS "Service Role Upload"
ON storage.objects FOR INSERT
WITH CHECK ( bucket_id = 'template-thumbnails' );
```

### 步骤3：设置环境变量并运行

在 PowerShell 中运行：

```powershell
# 进入项目目录
cd C:\Users\USER\Desktop\mynook

# 设置环境变量（替换成你的实际值）
$env:VITE_SUPABASE_URL="https://your-project.supabase.co"
$env:SUPABASE_SERVICE_ROLE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

# 运行上传脚本
npx tsx scripts/upload-test-thumbnails.ts
```

### 预期输出

```
🚀 测试上传缩略图工具

✅ Supabase 客户端创建成功

📊 找到 3 个图片文件

[1/3] 处理: Latte___Creamy_Style_Living_Room_1760359717742.png
   📋 模板: Latte / Creamy Style Living Room
   🔑 ID: 1df50169-533c-4745-9157-902b9e55ffe8
   📤 上传到: style/living-room/1df50169-533c-4745-9157-902b9e55ffe8.png
   ✅ 上传成功: https://xxx.supabase.co/storage/v1/...
   ✅ 数据库更新成功

[2/3] 处理: style_living-room_latte-creamy-style-living-room_1760360118928.png
   📋 模板: Latte / Creamy Style Living Room
   🔑 ID: 1df50169-533c-4745-9157-902b9e55ffe8
   📤 上传到: style/living-room/1df50169-533c-4745-9157-902b9e55ffe8.png
   ✅ 上传成功: https://xxx.supabase.co/storage/v1/...
   ✅ 数据库更新成功

[3/3] 处理: style_living-room_organic-modern-living-room_1760360118928.png
   📋 模板: Organic Modern Living Room
   🔑 ID: 18f2c806-f0f5-435c-acea-e3036c6a16ac
   📤 上传到: style/living-room/18f2c806-f0f5-435c-acea-e3036c6a16ac.png
   ✅ 上传成功: https://xxx.supabase.co/storage/v1/...
   ✅ 数据库更新成功


📊 上传统计

总文件数: 3
✅ 成功: 3
❌ 失败: 0

✨ 完成!
```

---

## ✅ 验证结果

### 1. 检查 Storage

访问 Supabase Dashboard → Storage → `template-thumbnails`

应该看到：
```
template-thumbnails/
└── style/
    └── living-room/
        ├── 1df50169-533c-4745-9157-902b9e55ffe8.png (Latte)
        └── 18f2c806-f0f5-435c-acea-e3036c6a16ac.png (Organic)
```

### 2. 检查数据库

在 SQL Editor 执行：
```sql
SELECT id, name, image_url
FROM design_templates
WHERE id IN (
    '1df50169-533c-4745-9157-902b9e55ffe8',
    '18f2c806-f0f5-435c-acea-e3036c6a16ac'
);
```

应该看到 `image_url` 已更新为新的 Supabase URL。

### 3. 测试图片访问

复制一个 image_url，在浏览器中打开，应该能看到你上传的图片。

---

## 🐛 常见问题

### Q: 脚本报错 "Missing Supabase environment variables"？
**A**: 确认环境变量已正确设置。在同一个 PowerShell 窗口中运行：
```powershell
echo $env:VITE_SUPABASE_URL
echo $env:SUPABASE_SERVICE_ROLE_KEY
```

### Q: 上传失败 "Bucket not found"？
**A**: Storage Bucket 还没创建，按照步骤2创建。

### Q: 数据库更新失败？
**A**: 检查 template ID 是否正确。运行：
```sql
SELECT id, name FROM design_templates WHERE name LIKE '%Latte%' OR name LIKE '%Organic%';
```

### Q: 图片上传成功但无法访问？
**A**: 确保 Bucket 设置为公开访问 (Public)。

---

## 📝 脚本说明

我创建的脚本 (`scripts/upload-test-thumbnails.ts`) 会：

1. ✅ 读取 `upload/` 文件夹中的所有 PNG 文件
2. ✅ 根据文件名映射到对应的模板
3. ✅ 上传到 Supabase Storage (`template-thumbnails` bucket)
4. ✅ 自动更新 `design_templates` 表的 `image_url` 字段
5. ✅ 显示详细的进度和结果

---

## 🎯 下一步

上传成功后：
1. 在网站上测试 Interior Design 功能
2. 选择 Living Room 房间类型
3. 应该能看到新的缩略图
4. 如果效果好，可以继续上传更多模板的缩略图

---

**需要帮助？** 随时告诉我遇到的问题！

