# âœ… Vertex AI å¿«é€Ÿé…ç½® - gemini-2.5-flash-image

**æ—¥æœŸ**: 2025å¹´10æœˆ11æ—¥  
**çŠ¶æ€**: âœ… ä»£ç å·²æ›´æ–°ï¼Œç­‰å¾…é…ç½®

## ä¸ºä»€ä¹ˆéœ€è¦ Vertex AIï¼Ÿ

`gemini-2.5-flash-image` æ¨¡å‹**åªæ”¯æŒ Vertex AI è®¤è¯**ï¼Œä¸æ”¯æŒæ™®é€šçš„ API Keyã€‚è¿™æ˜¯ Google æœ€æ–°çš„å›¾åƒç”Ÿæˆæ¨¡å‹ï¼Œæ”¯æŒï¼š

- âœ… åŸºäºå‚è€ƒå›¾åƒçš„ç¼–è¾‘
- âœ… é«˜è´¨é‡å›¾åƒç”Ÿæˆ
- âœ… æ›´å¥½çš„é£æ ¼è¿ç§»

## å¿«é€Ÿé…ç½®æ­¥éª¤ï¼ˆ5æ­¥ï¼‰

### ç¬¬ 1 æ­¥ï¼šåˆ›å»º Google Cloud é¡¹ç›®

1. è®¿é—® https://console.cloud.google.com/
2. ç‚¹å‡»å³ä¸Šè§’ "Select a project" â†’ "NEW PROJECT"
3. è¾“å…¥é¡¹ç›®åç§°ï¼ˆå¦‚ `mynook-ai`ï¼‰
4. è®°ä¸‹ **é¡¹ç›® ID**ï¼ˆå¦‚ `mynook-ai-123456`ï¼‰

### ç¬¬ 2 æ­¥ï¼šå¯ç”¨å¿…è¦çš„ API

åœ¨ Google Cloud Console ä¸­ï¼š

1. æœç´¢æ¡†è¾“å…¥ "Vertex AI API" â†’ ç‚¹å‡» "ENABLE"
2. æœç´¢ "Generative Language API" â†’ ç‚¹å‡» "ENABLE"

â±ï¸ è¿™ä¸€æ­¥éœ€è¦ 1-2 åˆ†é’Ÿ

### ç¬¬ 3 æ­¥ï¼šåˆ›å»ºæœåŠ¡è´¦å·

1. è¿›å…¥ **IAM & Admin** â†’ **Service Accounts**
2. ç‚¹å‡» "**+ CREATE SERVICE ACCOUNT**"
3. å¡«å†™ï¼š
   - Name: `mynook-vertex-ai`
   - ç‚¹å‡» "CREATE AND CONTINUE"
4. é€‰æ‹©è§’è‰²ï¼š
   - æœç´¢å¹¶é€‰æ‹© "**Vertex AI User**"
   - ç‚¹å‡» "CONTINUE" â†’ "DONE"

### ç¬¬ 4 æ­¥ï¼šä¸‹è½½æœåŠ¡è´¦å·å¯†é’¥

1. åœ¨æœåŠ¡è´¦å·åˆ—è¡¨ä¸­ï¼Œç‚¹å‡»åˆšåˆ›å»ºçš„è´¦å·
2. åˆ‡æ¢åˆ° "**KEYS**" æ ‡ç­¾
3. ç‚¹å‡» "**ADD KEY**" â†’ "**Create new key**"
4. é€‰æ‹©æ ¼å¼ï¼š**JSON**
5. ç‚¹å‡» "**CREATE**"

âš ï¸ **é‡è¦**ï¼šä¼šè‡ªåŠ¨ä¸‹è½½ä¸€ä¸ª JSON æ–‡ä»¶ï¼Œç±»ä¼¼ï¼š
```
mynook-ai-123456-a1b2c3d4e5f6.json
```

### ç¬¬ 5 æ­¥ï¼šåœ¨ Vercel ä¸­é…ç½®ç¯å¢ƒå˜é‡

#### æ–¹å¼ä¸€ï¼šåœ¨ Vercel Dashboard é…ç½®ï¼ˆæ¨èï¼‰

1. æ‰“å¼€ https://vercel.com/dashboard
2. é€‰æ‹© `mynook` é¡¹ç›®
3. è¿›å…¥ **Settings** â†’ **Environment Variables**
4. æ·»åŠ ä»¥ä¸‹å˜é‡ï¼š

| å˜é‡å | å€¼ | è¯´æ˜ |
|--------|-----|------|
| `GOOGLE_GENAI_USE_VERTEXAI` | `true` | å¯ç”¨ Vertex AI |
| `GOOGLE_CLOUD_PROJECT` | `mynook-ai-123456` | ä½ çš„é¡¹ç›® ID |
| `GOOGLE_CLOUD_LOCATION` | `us-central1` | åŒºåŸŸï¼ˆæ¨èï¼‰ |
| `GOOGLE_APPLICATION_CREDENTIALS_JSON` | `{å®Œæ•´JSONå†…å®¹}` | æœåŠ¡è´¦å·å¯†é’¥ |

##### å¦‚ä½•å¡«å†™ GOOGLE_APPLICATION_CREDENTIALS_JSONï¼š

1. ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ä¸‹è½½çš„ JSON æ–‡ä»¶
2. å¤åˆ¶**å®Œæ•´å†…å®¹**ï¼ˆåŒ…æ‹¬æ‰€æœ‰å¤§æ‹¬å·ï¼‰
3. ç²˜è´´åˆ° Value æ 

**ç¤ºä¾‹æ ¼å¼**ï¼ˆä¸è¦ä½¿ç”¨è¿™ä¸ªï¼Œç”¨ä½ è‡ªå·±çš„ï¼ï¼‰ï¼š
```json
{"type":"service_account","project_id":"mynook-ai-123456","private_key_id":"abc123...","private_key":"-----BEGIN PRIVATE KEY-----\nMIIE...çœŸå®å¯†é’¥å¾ˆé•¿...\n-----END PRIVATE KEY-----\n","client_email":"mynook-vertex-ai@mynook-ai-123456.iam.gserviceaccount.com","client_id":"123456789","auth_uri":"https://accounts.google.com/o/oauth2/auth","token_uri":"https://oauth2.googleapis.com/token","auth_provider_x509_cert_url":"https://www.googleapis.com/oauth2/v1/certs"}
```

#### æ–¹å¼äºŒï¼šä½¿ç”¨ Vercel CLI

```bash
vercel env add GOOGLE_GENAI_USE_VERTEXAI
# è¾“å…¥: true

vercel env add GOOGLE_CLOUD_PROJECT
# è¾“å…¥: mynook-ai-123456

vercel env add GOOGLE_CLOUD_LOCATION
# è¾“å…¥: us-central1

vercel env add GOOGLE_APPLICATION_CREDENTIALS_JSON
# è¾“å…¥: {ç²˜è´´å®Œæ•´JSONå†…å®¹}
```

### ç¬¬ 6 æ­¥ï¼šå¯ç”¨è®¡è´¹ï¼ˆé‡è¦ï¼ï¼‰

âš ï¸ Vertex AI æ˜¯ä»˜è´¹æœåŠ¡ï¼Œä½†ï¼š

- ğŸ **æ–°ç”¨æˆ·æœ‰ $300 å…è´¹é¢åº¦**ï¼ˆ90å¤©æœ‰æ•ˆï¼‰
- ğŸ’° `gemini-2.5-flash-image` éå¸¸ä¾¿å®œï¼ˆçº¦ $0.0001/å¼ ï¼‰
- ğŸ“Š å¯ä»¥è®¾ç½®é¢„ç®—è­¦æŠ¥

**å¯ç”¨æ­¥éª¤**ï¼š

1. åœ¨ Google Cloud Console ä¸­ï¼Œç‚¹å‡» "Billing"
2. å…³è”ä¸€ä¸ªä»˜è´¹è´¦æˆ·ï¼ˆéœ€è¦ä¿¡ç”¨å¡ï¼‰
3. è®¾ç½®é¢„ç®—è­¦æŠ¥ï¼ˆæ¨è $10ï¼‰

## é‡æ–°éƒ¨ç½²

é…ç½®å®Œæˆåï¼Œä»£ç å·²ç»å‡†å¤‡å¥½ï¼Œç›´æ¥é‡æ–°éƒ¨ç½²ï¼š

```bash
git add .
git commit -m "feat: å¯ç”¨ Vertex AI æ”¯æŒ gemini-2.5-flash-image"
git push
```

## éªŒè¯é…ç½®

éƒ¨ç½²å®Œæˆåï¼Œåœ¨ Vercel Logs ä¸­åº”è¯¥çœ‹åˆ°ï¼š

```
âœ… Vertex AI configured: project=mynook-ai-123456, location=us-central1
ğŸ”§ Initializing Vertex AI client for user ...
ğŸ¤– Using model: gemini-2.5-flash-image (Vertex AI)
ğŸ“¤ Calling Vertex AI with 1 reference image(s)...
âœ… Image generated successfully for user ...
```

## æ•…éšœæ’æŸ¥

### é”™è¯¯ï¼šVertex AI is not configured

**åŸå› **: ç¯å¢ƒå˜é‡æœªè®¾ç½®

**è§£å†³**: æ£€æŸ¥ Vercel ä¸­çš„ç¯å¢ƒå˜é‡ï¼Œç¡®ä¿ï¼š
- `GOOGLE_GENAI_USE_VERTEXAI=true`
- `GOOGLE_CLOUD_PROJECT` å·²è®¾ç½®

### é”™è¯¯ï¼šPermission denied

**åŸå› **: æœåŠ¡è´¦å·æƒé™ä¸è¶³

**è§£å†³**: 
1. è¿›å…¥ IAM & Admin â†’ Service Accounts
2. ç¡®è®¤æœåŠ¡è´¦å·æœ‰ "Vertex AI User" è§’è‰²

### é”™è¯¯ï¼šAPI not enabled

**åŸå› **: Vertex AI API æœªå¯ç”¨

**è§£å†³**: 
1. æœç´¢ "Vertex AI API"
2. ç‚¹å‡» "ENABLE"

### é”™è¯¯ï¼šBilling account required

**åŸå› **: æœªå¯ç”¨è®¡è´¹

**è§£å†³**: æŒ‰ç…§ç¬¬ 6 æ­¥å¯ç”¨è®¡è´¹è´¦æˆ·

## ä»·æ ¼ä¼°ç®—

å‡è®¾æ¯å¤©ç”Ÿæˆ 100 å¼ å›¾ç‰‡ï¼š

- **gemini-2.5-flash-image**: çº¦ $0.01/å¤©
- **æ¯æœˆ**: çº¦ $0.30
- **ä½¿ç”¨ $300 å…è´¹é¢åº¦**: å¯ç”¨ 1000 ä¸ªæœˆ ğŸ˜Š

## å¯¹æ¯”

| æ–¹æ¡ˆ | è®¤è¯æ–¹å¼ | æ¨¡å‹ | æ”¯æŒå›¾åƒç¼–è¾‘ | ä»·æ ¼ |
|------|----------|------|--------------|------|
| **ä¹‹å‰ï¼ˆAPI Keyï¼‰** | API Key | imagen-3.0 | âŒ ä¸æ”¯æŒ | ä¸­ç­‰ |
| **ç°åœ¨ï¼ˆVertex AIï¼‰** | æœåŠ¡è´¦å· | gemini-2.5-flash-image | âœ… æ”¯æŒ | ä¾¿å®œ |

## ä¸‹ä¸€æ­¥

é…ç½®å®Œæˆåï¼š

1. âœ… æ¨é€ä»£ç åˆ° Vercel
2. âœ… ç­‰å¾…éƒ¨ç½²å®Œæˆï¼ˆ1-2åˆ†é’Ÿï¼‰
3. âœ… æµ‹è¯•å›¾åƒç”ŸæˆåŠŸèƒ½
4. âœ… æŸ¥çœ‹ Vercel Logs ç¡®è®¤ä¸€åˆ‡æ­£å¸¸

## ç›¸å…³æ–‡ä»¶

- `api/generate-image.ts` - å·²æ›´æ–°æ”¯æŒ Vertex AI
- `VERTEX_AI_é…ç½®æŒ‡å—.md` - è¯¦ç»†é…ç½®æ–‡æ¡£
- `package.json` - ä¾èµ–åŒ…ï¼ˆæ— éœ€ä¿®æ”¹ï¼Œ`@google/genai` å·²æ”¯æŒï¼‰

---

**éœ€è¦å¸®åŠ©ï¼Ÿ** æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š[VERTEX_AI_é…ç½®æŒ‡å—.md](./VERTEX_AI_é…ç½®æŒ‡å—.md)

