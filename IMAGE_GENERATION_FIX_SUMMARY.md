# ğŸ”§ å›¾ç‰‡ç”Ÿæˆé—®é¢˜ä¿®å¤æ€»ç»“

## å·²å®Œæˆçš„æ”¹è¿›

### 1. âœ… æ”¹è¿›äº† Base64 å›¾ç‰‡å¤„ç†
æ·»åŠ äº† `normalizeBase64Image` å‡½æ•°ï¼Œè‡ªåŠ¨å¤„ç†ï¼š
- å»é™¤ç©ºæ ¼å’Œæ¢è¡Œ
- è‡ªåŠ¨ç§»é™¤ `data:image/png;base64,` å‰ç¼€
- éªŒè¯æ•°æ®æœ‰æ•ˆæ€§

### 2. âœ… å¢å¼ºäº†é”™è¯¯æŠ¥å‘Š
- åœ¨ catch å—ä¸­æ·»åŠ è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- è¿”å› `details` å­—æ®µå¸®åŠ©è°ƒè¯•
- æ›´æ¸…æ™°çš„æ§åˆ¶å°æ—¥å¿—

### 3. âœ… ä»£ç è§„èŒƒåŒ–
- æ”¹è¿›äº†ç±»å‹å®‰å…¨
- æ›´å¥½çš„é”™è¯¯å¤„ç†æµç¨‹

## ğŸ¯ æ¥ä¸‹æ¥éœ€è¦æ£€æŸ¥çš„äº‹é¡¹

### åœ¨ Vercel ä¸Šï¼š

1. **ç¡®è®¤ç¯å¢ƒå˜é‡é…ç½®**
   - è®¿é—®ï¼šhttps://vercel.com/dashboard â†’ ä½ çš„é¡¹ç›® â†’ Settings â†’ Environment Variables
   - ç¡®è®¤ `GEMINI_API_KEY` å­˜åœ¨
   - ç¡®è®¤åº”ç”¨åˆ° Production ç¯å¢ƒ

2. **æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—**
   - Vercel Dashboard â†’ Deployments â†’ æœ€æ–°éƒ¨ç½²
   - ç‚¹å‡» **Functions** æ ‡ç­¾
   - æŸ¥æ‰¾ `/api/generate-image` çš„é”™è¯¯æ—¥å¿—
   - **ç°åœ¨é”™è¯¯ä¿¡æ¯ä¼šæ›´è¯¦ç»†ï¼ŒåŒ…å« `details` å­—æ®µ**

3. **æµ‹è¯•æ­¥éª¤**
   ```bash
   # æäº¤å¹¶æ¨é€æ›´æ”¹
   git add .
   git commit -m "Fix: Improve image generation error handling and base64 processing"
   git push
   ```

4. **ç­‰å¾…éƒ¨ç½²å®Œæˆ**
   - Vercel ä¼šè‡ªåŠ¨éƒ¨ç½²
   - éƒ¨ç½²å®Œæˆåï¼Œåˆ·æ–°ä½ çš„ç½‘ç«™
   - å†æ¬¡å°è¯•ç”Ÿæˆå›¾ç‰‡

5. **æŸ¥çœ‹æ–°çš„é”™è¯¯ä¿¡æ¯**
   - æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
   - è¿›å…¥ Network æ ‡ç­¾
   - å°è¯•ç”Ÿæˆå›¾ç‰‡
   - æŸ¥çœ‹ `/api/generate-image` è¯·æ±‚çš„å“åº”
   - **ç°åœ¨å“åº”ä¸­ä¼šåŒ…å« `details` å­—æ®µï¼Œå‘Šè¯‰ä½ å…·ä½“é”™è¯¯**

## ğŸ” å¯èƒ½çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1ï¼šç¯å¢ƒå˜é‡æœªè®¾ç½®
**ç—‡çŠ¶**ï¼šé”™è¯¯ä¿¡æ¯ "API key not configured"
**è§£å†³**ï¼šåœ¨ Vercel Settings â†’ Environment Variables æ·»åŠ  `GEMINI_API_KEY`

### é—®é¢˜2ï¼šAPI Key æ— æ•ˆ
**ç—‡çŠ¶**ï¼šé”™è¯¯ä¿¡æ¯åŒ…å« "API key not valid" æˆ– "authentication"
**è§£å†³**ï¼š
1. è®¿é—® https://aistudio.google.com/app/apikey
2. é‡æ–°ç”Ÿæˆ API Key
3. æ›´æ–° Vercel ç¯å¢ƒå˜é‡
4. é‡æ–°éƒ¨ç½²

### é—®é¢˜3ï¼šæ¨¡å‹æƒé™é—®é¢˜
**ç—‡çŠ¶**ï¼šé”™è¯¯ä¿¡æ¯åŒ…å« "model not found" æˆ– "permission denied"
**è§£å†³**ï¼šä¿®æ”¹ `api/generate-image.ts` ç¬¬146è¡Œï¼Œå°†æ¨¡å‹æ”¹ä¸ºï¼š
```typescript
model: 'gemini-1.5-flash',  // æˆ– 'gemini-1.5-pro'
```

### é—®é¢˜4ï¼šé…é¢è¶…é™
**ç—‡çŠ¶**ï¼šé”™è¯¯ä¿¡æ¯åŒ…å« "quota" æˆ– "rate limit"
**è§£å†³**ï¼š
1. è®¿é—® https://aistudio.google.com/
2. æ£€æŸ¥ä½¿ç”¨é‡
3. ç­‰å¾…é…é¢é‡ç½®

### é—®é¢˜5ï¼šå›¾ç‰‡æ ¼å¼é—®é¢˜
**ç—‡çŠ¶**ï¼šé”™è¯¯ä¿¡æ¯åŒ…å« "invalid image" æˆ– "format"
**è§£å†³**ï¼šç°åœ¨å·²ç»æ·»åŠ äº† `normalizeBase64Image` å‡½æ•°è‡ªåŠ¨å¤„ç†

## ğŸ“ ä¸‹ä¸€æ­¥æ“ä½œ

1. **æ¨é€ä»£ç åˆ° Git**
   ```bash
   git add .
   git commit -m "Fix: Improve image generation with better error handling"
   git push
   ```

2. **ç­‰å¾… Vercel è‡ªåŠ¨éƒ¨ç½²**ï¼ˆçº¦1-2åˆ†é’Ÿï¼‰

3. **æµ‹è¯•å¹¶æŸ¥çœ‹è¯¦ç»†é”™è¯¯**
   - åˆ·æ–°ç½‘ç«™
   - å°è¯•ç”Ÿæˆå›¾ç‰‡
   - æŸ¥çœ‹ Network æ ‡ç­¾çš„å“åº”ä¸­çš„ `details` å­—æ®µ

4. **æ ¹æ®è¯¦ç»†é”™è¯¯ä¿¡æ¯é‡‡å–è¡ŒåŠ¨**
   - å¦‚æœæ˜¯ API Key é—®é¢˜ â†’ æ£€æŸ¥ç¯å¢ƒå˜é‡
   - å¦‚æœæ˜¯æ¨¡å‹é—®é¢˜ â†’ æ¢ä¸ªæ¨¡å‹è¯•è¯•
   - å¦‚æœæ˜¯æƒé™é—®é¢˜ â†’ æ£€æŸ¥ API Key æƒé™

## ğŸ†˜ å¦‚æœè¿˜æ˜¯ä¸è¡Œ

æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
1. Vercel é¡¹ç›® URL
2. æµè§ˆå™¨æ§åˆ¶å°çš„å®Œæ•´é”™è¯¯ï¼ˆåŒ…æ‹¬æ–°çš„ `details` å­—æ®µï¼‰
3. Vercel Function Logs çš„æˆªå›¾
4. ç¡®è®¤ç¯å¢ƒå˜é‡å·²é…ç½®çš„æˆªå›¾ï¼ˆéšè—å®é™…çš„ key å€¼ï¼‰

