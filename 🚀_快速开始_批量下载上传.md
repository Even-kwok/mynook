# 🚀 快速开始 - 批量下载与上传

**适合**: 想要快速测试功能的用户  
**时间**: 约 10 分钟

---

## 📝 前提条件

- ✅ 网站已部署到 Vercel
- ✅ Supabase 项目已配置
- ✅ 有 Supabase Service Role Key

---

## 第一步：生成并下载图片 (前端)

### 1.1 访问网站
打开 Vercel 预览链接（等待部署完成）

### 1.2 生成图片
1. 登录账号
2. 进入 **Interior Design** 页面
3. 上传一张房间图片
4. 选择房间类型（如 Living Room）
5. 选择 2-3 个模板
6. 点击生成

### 1.3 批量下载
1. 打开右侧 **My Designs** 侧边栏
2. 找到顶部的 **"批量下载全部 (n)"** 按钮
3. 点击按钮
4. 确认下载
5. 等待所有图片下载完成

**下载位置**: 浏览器默认下载文件夹

**文件名示例**:
```
style_living-room_modern-minimalist_1728835200000_modern-minimalist.png
style_living-room_scandinavian_1728835201000_scandinavian.png
```

---

## 第二步：准备上传 (本地)

### 2.1 创建文件夹
```bash
cd mynook
mkdir downloaded-images
```

### 2.2 移动文件
将下载的图片移动到 `downloaded-images/` 文件夹

**Windows**:
```powershell
move C:\Users\USER\Downloads\style_*.png downloaded-images\
move C:\Users\USER\Downloads\exterior_*.png downloaded-images\
move C:\Users\USER\Downloads\garden_*.png downloaded-images\
```

**Mac/Linux**:
```bash
mv ~/Downloads/style_*.png downloaded-images/
mv ~/Downloads/exterior_*.png downloaded-images/
mv ~/Downloads/garden_*.png downloaded-images/
```

### 2.3 验证文件
```bash
ls downloaded-images/
# 或 Windows: dir downloaded-images\
```

应该看到类似这样的文件：
```
style_living-room_modern-minimalist_xxx.png
style_bedroom_scandinavian_xxx.png
exterior_house_contemporary_xxx.png
```

---

## 第三步：配置 Supabase

### 3.1 创建 Storage Bucket

**方式A: 在 Supabase Dashboard**
1. 打开 https://supabase.com/dashboard
2. 进入你的项目
3. 点击左侧 **Storage**
4. 点击 **New Bucket**
5. 名称: `template-thumbnails`
6. 公开访问: ✅ 勾选 Public
7. 点击 **Create Bucket**

**方式B: 使用 SQL**
```sql
-- 在 SQL Editor 中执行
INSERT INTO storage.buckets (id, name, public)
VALUES ('template-thumbnails', 'template-thumbnails', true);

-- 设置公开访问策略
CREATE POLICY "Public Access"
ON storage.objects FOR SELECT
USING ( bucket_id = 'template-thumbnails' );

-- 允许服务密钥上传
CREATE POLICY "Service Role Upload"
ON storage.objects FOR INSERT
WITH CHECK ( bucket_id = 'template-thumbnails' );
```

### 3.2 获取 Service Role Key

1. 在 Supabase Dashboard
2. 点击左侧 **Settings** (齿轮图标)
3. 点击 **API**
4. 找到 **service_role** key
5. 点击眼睛图标查看
6. 复制密钥

**⚠️ 重要**: Service Role Key 有完全权限，不要公开！

---

## 第四步：运行上传脚本

### 4.1 设置环境变量

**Windows PowerShell**:
```powershell
$env:VITE_SUPABASE_URL="https://your-project.supabase.co"
$env:SUPABASE_SERVICE_ROLE_KEY="your-service-role-key-here"
```

**Mac/Linux**:
```bash
export VITE_SUPABASE_URL="https://your-project.supabase.co"
export SUPABASE_SERVICE_ROLE_KEY="your-service-role-key-here"
```

### 4.2 运行脚本
```bash
npx tsx scripts/upload-thumbnails.ts
```

### 4.3 预期输出
```
🚀 批量上传缩略图工具

📁 图片文件夹: /Users/xxx/mynook/downloaded-images
🗄️  Storage Bucket: template-thumbnails
✅ 生产模式

✅ Supabase 客户端创建成功

📊 找到 5 个图片文件

[1/5] 处理: style_living-room_modern-minimalist_xxx.png
   📋 元数据:
      - 功能类型: style
      - 房间类型: living-room
      - 模板ID: modern-minimalist
   📤 上传: ... → style/living-room/modern-minimalist_xxx.png
   ✅ 上传成功: https://xxx.supabase.co/...
   ✅ 数据库更新成功: Modern Minimalist

...

📊 上传统计

总文件数: 5
✅ 上传成功: 5
❌ 上传失败: 0
✅ 数据库更新成功: 5
❌ 数据库更新失败: 0

✨ 完成!
```

---

## 第五步：验证结果

### 5.1 检查 Storage

1. 打开 Supabase Dashboard → Storage
2. 点击 `template-thumbnails` bucket
3. 应该看到按类型和房间分类的文件夹结构：

```
template-thumbnails/
├── style/
│   └── living-room/
│       ├── modern-minimalist_xxx.png
│       └── scandinavian_xxx.png
├── exterior/
│   └── house/
│       └── contemporary_xxx.png
└── garden/
    └── no-room/
        └── japanese-zen-garden_xxx.png
```

### 5.2 检查数据库

在 Supabase SQL Editor 中执行：
```sql
SELECT id, name, image_url, room_type
FROM design_templates
WHERE image_url IS NOT NULL
ORDER BY updated_at DESC
LIMIT 10;
```

应该看到 `image_url` 字段已被更新。

### 5.3 测试图片访问

复制一个 `image_url`，在浏览器中访问，应该能看到图片。

---

## 🎉 完成！

恭喜！你已经成功完成了第一次批量下载和上传！

**现在你可以**:
- ✅ 在前端生成图片
- ✅ 一键批量下载
- ✅ 批量上传到 Supabase
- ✅ 自动更新模板缩略图

---

## ⚠️ 常见问题

### Q: 浏览器阻止了下载？
**A**: 点击地址栏右侧的下载图标，选择"允许多次下载"

### Q: 脚本报错找不到文件夹？
**A**: 确保在项目根目录运行脚本，并且 `downloaded-images/` 文件夹存在

### Q: 上传失败 "Missing environment variables"？
**A**: 检查环境变量是否正确设置，注意 PowerShell 和 Bash 的语法不同

### Q: 数据库未更新？
**A**: 检查模板 ID 是否匹配。文件名中的 `templateId` 应该与数据库中的 `id` 字段一致

### Q: 图片上传成功但无法访问？
**A**: 确保 Storage Bucket 设置为公开访问 (Public)

---

## 📚 详细文档

需要更多信息？查看这些文档：

- **✅_批量下载上传功能完成_2025_10_13.md** - 功能详细说明
- **📦_批量下载上传工作流程_2025_10_13.md** - 完整工作流程
- **图片路径信息测试指南_2025_10_13.md** - 测试步骤

---

## 🔧 测试模式

如果想先测试不实际上传，编辑 `scripts/upload-thumbnails.ts`:

```typescript
// 设置为 true 启用测试模式
const DRY_RUN = true;
```

然后运行脚本，会显示解析信息但不实际上传。

---

## 🎯 下次使用

下次使用时，只需要：

1. 前端生成图片
2. 点击"批量下载全部"
3. 移动文件到 `downloaded-images/`
4. 运行 `npx tsx scripts/upload-thumbnails.ts`

就这么简单！ 🚀

---

**需要帮助？** 查看详细文档或联系开发团队。

