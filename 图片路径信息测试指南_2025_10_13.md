# 图片路径信息显示 - 测试指南

**测试日期**: 2025年10月13日  
**功能**: 在生成图片时保存并显示完整的路径信息

---

## 🎯 测试目标

验证每个生成的图片都能正确显示完整路径：
```
功能类型 → 房间类型/建筑类型 → 风格分类 → 模板名称
```

---

## 📋 测试步骤

### 1️⃣ 测试 Interior Design 功能

#### 操作步骤：
1. 进入 **Interior Design** 页面
2. 上传一张房间图片
3. 选择房间类型：**Living Room**
4. 选择风格分类：**Design Aesthetics**
5. 选择模板：**Modern Minimalist**
6. 点击生成

#### 预期结果：
- 图片生成完成后，在右侧 **My Designs** 侧边栏可以看到图片
- 悬停在图片上，应该显示：
  ```
  Interior Designs → Living Room → Design Aesthetics → Modern Minimalist
  ```
- 第二行显示生成时间

---

### 2️⃣ 测试 Exterior Design 功能

#### 操作步骤：
1. 进入 **Exterior Design** 页面
2. 上传一张建筑外观图片
3. 选择建筑类型：**House**
4. 选择风格分类：**Architectural Styles**
5. 选择模板：**Contemporary**
6. 点击生成

#### 预期结果：
悬停在生成的图片上，应该显示：
```
Exterior Designs → House → Architectural Styles → Contemporary
```

---

### 3️⃣ 测试 Garden & Backyard Design 功能

#### 操作步骤：
1. 进入 **Garden & Backyard Design** 页面
2. 上传一张花园图片
3. 选择模板：**Japanese Zen Garden**
4. 点击生成

#### 预期结果：
悬停在生成的图片上，应该显示：
```
Garden Designs → Japanese Zen Garden
```
（Garden 功能没有房间类型，所以只有功能类型和模板名称）

---

### 4️⃣ 测试 Wall Paint 功能

#### 操作步骤：
1. 进入 **Wall Paint** 页面
2. 上传一张房间图片
3. 选择墙漆颜色
4. 点击生成

#### 预期结果：
悬停在生成的图片上，应该显示：
```
Wall Paints → [墙漆模板名称]
```

---

### 5️⃣ 测试 Floor Style 功能

#### 操作步骤：
1. 进入 **Floor Style** 页面
2. 上传一张房间图片
3. 选择地板样式
4. 点击生成

#### 预期结果：
悬停在生成的图片上，应该显示：
```
Floor Styles → [地板样式名称]
```

---

### 6️⃣ 测试多模板生成

#### 操作步骤：
1. 进入 **Interior Design** 页面
2. 上传一张房间图片
3. 选择房间类型：**Bedroom**
4. 选择 **3个不同的模板**（例如：Modern Minimalist, Scandinavian, Bohemian）
5. 点击生成

#### 预期结果：
- 生成 3 张图片
- 每张图片悬停时都显示对应的完整路径：
  ```
  Interior Designs → Bedroom → Design Aesthetics → Modern Minimalist
  Interior Designs → Bedroom → Design Aesthetics → Scandinavian
  Interior Designs → Bedroom → Design Aesthetics → Bohemian
  ```

---

## 🔍 检查清单

### ✅ 显示正确性
- [ ] 功能类型显示正确（Interior Designs, Exterior Designs 等）
- [ ] 房间类型/建筑类型显示正确
- [ ] 风格分类显示正确
- [ ] 模板名称显示正确
- [ ] 路径使用 `→` 符号连接
- [ ] 文字不会溢出（使用了 truncate）
- [ ] 完整路径在 title 属性中可见（鼠标悬停时浏览器会显示完整文本）

### ✅ 交互体验
- [ ] 鼠标悬停时文字淡入显示
- [ ] 时间戳显示在第二行
- [ ] 文字颜色清晰可读（白色文字 + 黑色半透明背景）
- [ ] 不会遮挡下载和删除按钮

### ✅ 数据完整性
- [ ] 打开浏览器控制台，检查 `generationHistory` 数组
- [ ] 每个 batch 应该包含 `roomTypeId` 或 `buildingTypeId`
- [ ] 每个 result 应该包含 `templateId`, `templateName`, `templateCategory` 等字段

---

## 🐛 可能的问题和解决方案

### 问题1：路径显示不完整
**症状**: 只显示部分信息，例如只有 "Interior Designs → Modern Minimalist"，缺少房间类型

**原因**: `roomTypeId` 可能没有正确保存

**检查方法**:
```javascript
// 在浏览器控制台执行
console.log(generationHistory[0]);
// 检查输出的 batch 是否有 roomTypeId 字段
```

---

### 问题2：显示 "Unknown"
**症状**: 路径中出现 "Unknown"

**原因**: 某个 ID 在常量数组中找不到对应的名称

**检查方法**:
```javascript
// 检查 ROOM_TYPES 和 BUILDING_TYPES
import { ROOM_TYPES, BUILDING_TYPES } from './constants';
console.log('ROOM_TYPES:', ROOM_TYPES);
console.log('BUILDING_TYPES:', BUILDING_TYPES);
```

---

### 问题3：旧图片没有完整路径
**症状**: 之前生成的图片只显示模板名称

**原因**: 旧数据没有新的元数据字段（这是正常的）

**解决方案**: 
- 这是预期行为，新字段是可选的，向后兼容
- 重新生成图片会有完整路径信息

---

## 📊 控制台调试命令

### 查看所有生成历史
```javascript
console.table(generationHistory.map(b => ({
    id: b.id,
    type: b.type,
    roomTypeId: b.roomTypeId,
    buildingTypeId: b.buildingTypeId,
    prompt: b.prompt,
    resultsCount: b.results.length
})));
```

### 查看最新一批的详细信息
```javascript
const latest = generationHistory[0];
console.log('Latest Batch:', {
    type: latest.type,
    roomTypeId: latest.roomTypeId,
    buildingTypeId: latest.buildingTypeId,
    results: latest.results.map(r => ({
        templateId: r.templateId,
        templateName: r.templateName,
        templateCategory: r.templateCategory,
        templateSubCategory: r.templateSubCategory,
    }))
});
```

### 导出为 JSON
```javascript
const exportData = generationHistory.map(batch => ({
    batchId: batch.id,
    type: batch.type,
    roomTypeId: batch.roomTypeId,
    buildingTypeId: batch.buildingTypeId,
    timestamp: batch.timestamp,
    images: batch.results
        .filter(img => img.status === 'success' && img.imageUrl)
        .map(img => ({
            imageUrl: img.imageUrl,
            templateId: img.templateId,
            templateName: img.templateName,
            fullPath: [
                batch.type,
                batch.roomTypeId || batch.buildingTypeId,
                img.templateSubCategory || img.templateCategory,
                img.templateName
            ].filter(Boolean).join(' → '),
        }))
}));

// 复制到剪贴板
copy(JSON.stringify(exportData, null, 2));
console.log('✅ Data copied to clipboard!');
```

---

## ✅ 测试完成标准

所有以下条件都满足时，测试通过：

1. ✅ Interior Design 显示完整4级路径
2. ✅ Exterior Design 显示完整4级路径
3. ✅ Garden/Wall Paint/Floor Style 显示正确路径（2-3级）
4. ✅ 多模板生成时每个图片都有独立正确的路径
5. ✅ 文字显示清晰，不会溢出或遮挡按钮
6. ✅ 鼠标悬停体验流畅
7. ✅ 浏览器控制台没有错误

---

## 📸 截图建议

测试时建议截图以下场景：
1. Interior Design - Living Room - Modern Minimalist 的悬停效果
2. Exterior Design - House - Contemporary 的悬停效果
3. 多模板生成（3张图片）的 My Designs 侧边栏
4. 浏览器控制台显示的 `generationHistory` 数据

---

## 🚀 测试后的下一步

测试通过后：
1. 提交到 Git 仓库
2. 部署到 Vercel 预览环境
3. 在实际环境中测试
4. 准备批量上传到 Supabase 的工具

---

**祝测试顺利！** 🎉

