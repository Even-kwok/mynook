# ğŸš€ ç‰©å“æ›¿æ¢åŠŸèƒ½å¼€å‘åˆ†æ”¯åˆ›å»º

**æ—¥æœŸ**: 2025-10-18  
**åˆ†æ”¯å**: `feature/item-replace`  
**çŠ¶æ€**: âœ… å·²åˆ›å»ºå¹¶æ¨é€åˆ°è¿œç¨‹

---

## ğŸ“‹ åˆ†æ”¯ä¿¡æ¯

- **åˆ†æ”¯åç§°**: `feature/item-replace`
- **åŸºäºåˆ†æ”¯**: `public-beta` (æäº¤ `887b95b`)
- **è¿œç¨‹ä»“åº“**: `origin/feature/item-replace`
- **åˆ›å»ºæ—¶é—´**: 2025-10-18

---

## ğŸ¯ åŠŸèƒ½ç›®æ ‡

### Item Replaceï¼ˆç‰©å“æ›¿æ¢ï¼‰åŠŸèƒ½

è¿™æ˜¯ä¸€ä¸ªå…è®¸ç”¨æˆ·åœ¨ç°æœ‰è®¾è®¡ä¸­æ›¿æ¢ç‰¹å®šç‰©å“çš„åŠŸèƒ½ï¼Œç±»ä¼¼äºï¼š
- æ›¿æ¢æˆ¿é—´ä¸­çš„å®¶å…·
- æ›´æ¢å¢™ä¸Šçš„è£…é¥°å“
- ä¿®æ”¹ç‰¹å®šåŒºåŸŸçš„è®¾è®¡å…ƒç´ 

### é¢„æœŸå·¥ä½œæµç¨‹

1. **ä¸Šä¼ å›¾ç‰‡** - ç”¨æˆ·ä¸Šä¼ åŒ…å«ç‰©å“çš„å›¾ç‰‡
2. **é€‰æ‹©åŒºåŸŸ** - ç”¨æˆ·åœˆé€‰æˆ–æ ‡è®°è¦æ›¿æ¢çš„ç‰©å“
3. **æè¿°æ–°ç‰©å“** - ç”¨æˆ·æè¿°æƒ³è¦çš„æ›¿æ¢ç‰©å“
4. **AI ç”Ÿæˆ** - ç³»ç»Ÿç”Ÿæˆæ›¿æ¢åçš„æ•ˆæœå›¾
5. **é¢„è§ˆå¯¹æ¯”** - æ˜¾ç¤ºæ›¿æ¢å‰åçš„å¯¹æ¯”

---

## ğŸ› ï¸ æŠ€æœ¯æ¶æ„è§„åˆ’

### å‰ç«¯ç»„ä»¶ï¼ˆéœ€è¦åˆ›å»ºï¼‰

```
components/
  â””â”€â”€ ItemReplacePage.tsx          # ä¸»é¡µé¢ç»„ä»¶
  â””â”€â”€ ItemReplaceCanvas.tsx        # ç”»å¸ƒç»„ä»¶ï¼ˆåœˆé€‰åŒºåŸŸï¼‰
  â””â”€â”€ ItemReplacePreview.tsx       # é¢„è§ˆå¯¹æ¯”ç»„ä»¶
  â””â”€â”€ ItemReplaceHistory.tsx       # å†å²è®°å½•ç»„ä»¶
```

### API ç«¯ç‚¹ï¼ˆéœ€è¦åˆ›å»ºï¼‰

```
api/
  â””â”€â”€ item-replace/
      â”œâ”€â”€ upload.ts                # å›¾ç‰‡ä¸Šä¼ 
      â”œâ”€â”€ generate.ts              # AI ç”Ÿæˆæ›¿æ¢
      â””â”€â”€ history.ts               # å†å²è®°å½•ç®¡ç†
```

### æ•°æ®åº“è¡¨ï¼ˆéœ€è¦åˆ›å»ºï¼‰

```sql
-- ç‰©å“æ›¿æ¢å†å²è¡¨
CREATE TABLE item_replace_history (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES users(id),
  original_image_url TEXT NOT NULL,
  result_image_url TEXT,
  mask_data JSONB,                 -- åœˆé€‰åŒºåŸŸæ•°æ®
  replace_prompt TEXT,              -- æ›¿æ¢æè¿°
  status VARCHAR(20),               -- pending, processing, completed, failed
  credits_used INTEGER DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## ğŸ“¦ ä¾èµ–åº“è€ƒè™‘

### å‰ç«¯ç”»å¸ƒæ“ä½œ
- **Fabric.js** - ç”»å¸ƒæ“ä½œå’ŒåŒºåŸŸé€‰æ‹©
- **React Konva** - å¦ä¸€ä¸ªç”»å¸ƒåº“é€‰é¡¹
- **canvas-selector** - ä¸“é—¨çš„åŒºåŸŸé€‰æ‹©åº“

### å›¾åƒå¤„ç†
- **image-mask-editor** - é®ç½©ç¼–è¾‘
- **react-image-annotate** - å›¾åƒæ ‡æ³¨

### AI é›†æˆ
- **Vertex AI Vision API** - ç‰©å“è¯†åˆ«å’Œæ›¿æ¢
- **Stable Diffusion Inpainting** - å›¾åƒä¿®å¤æŠ€æœ¯

---

## ğŸ¨ UI/UX è®¾è®¡è¦ç‚¹

### ç”¨æˆ·ç•Œé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Header (MyNook Logo + User Menu)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚               â”‚   â”‚              â”‚  â”‚
â”‚  â”‚  Image Upload â”‚   â”‚  Description â”‚  â”‚
â”‚  â”‚  & Selection  â”‚   â”‚  & Controls  â”‚  â”‚
â”‚  â”‚               â”‚   â”‚              â”‚  â”‚
â”‚  â”‚  [Canvas]     â”‚   â”‚  - Prompt    â”‚  â”‚
â”‚  â”‚               â”‚   â”‚  - Replace   â”‚  â”‚
â”‚  â”‚               â”‚   â”‚  - Reset     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Preview (Before / After)       â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚   â”‚
â”‚  â”‚  â”‚   Before    â”‚    After     â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### äº¤äº’æµç¨‹

1. **Step 1: Upload**
   - æ‹–æ”¾æˆ–ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡
   - æ˜¾ç¤ºé¢„è§ˆ

2. **Step 2: Select**
   - ä½¿ç”¨ç”»ç¬”æˆ–å¥—ç´¢å·¥å…·åœˆé€‰ç‰©å“
   - å®æ—¶æ˜¾ç¤ºé€‰ä¸­åŒºåŸŸ

3. **Step 3: Describe**
   - è¾“å…¥æ›¿æ¢ç‰©å“æè¿°
   - å¯é€‰ï¼šé€‰æ‹©é¢„è®¾æ ·å¼

4. **Step 4: Generate**
   - ç‚¹å‡»"Replace"æŒ‰é’®
   - æ˜¾ç¤ºè¿›åº¦æ¡
   - æ¶ˆè€—ä¿¡ç”¨ç‚¹

5. **Step 5: Review**
   - å‰åå¯¹æ¯”æŸ¥çœ‹
   - ä¿å­˜æˆ–é‡æ–°ç”Ÿæˆ

---

## ğŸ’³ ä¿¡ç”¨ç‚¹ç³»ç»Ÿé›†æˆ

### æ¶ˆè€—è§„åˆ™ï¼ˆå»ºè®®ï¼‰

| æ“ä½œ | ä¿¡ç”¨ç‚¹æ¶ˆè€— | è¯´æ˜ |
|-----|----------|------|
| å°é¢ç§¯æ›¿æ¢ (< 25%) | 5 credits | å°ç‰©å“ï¼Œå¦‚ç›¸æ¡†ã€å°ç¯ |
| ä¸­é¢ç§¯æ›¿æ¢ (25-50%) | 10 credits | ä¸­å‹å®¶å…·ï¼Œå¦‚æ¤…å­ã€æ¡Œå­ |
| å¤§é¢ç§¯æ›¿æ¢ (> 50%) | 15 credits | å¤§å‹å®¶å…·æˆ–å¤šç‰©å“ |

### ä¼šå‘˜æƒç›Š

- **FREE**: ä¸å¯ç”¨ï¼ˆæç¤ºå‡çº§ï¼‰
- **PRO**: å¯ç”¨ï¼Œæ ‡å‡†ä»·æ ¼
- **PREMIUM**: å¯ç”¨ï¼Œ8æŠ˜ä¼˜æƒ 
- **BUSINESS**: å¯ç”¨ï¼Œ5æŠ˜ä¼˜æƒ  + ä¼˜å…ˆå¤„ç†

---

## ğŸ” æƒé™æ§åˆ¶

```typescript
// æƒé™æ£€æŸ¥
const canUseItemReplace = (user: User) => {
  return user.permissionLevel >= 2; // Pro åŠä»¥ä¸Š
};

// ä¿¡ç”¨ç‚¹æ£€æŸ¥
const hasEnoughCredits = (user: User, area: number) => {
  const required = calculateCredits(area);
  return user.credits >= required;
};
```

---

## ğŸ“Š å¼€å‘ä»»åŠ¡æ¸…å•

### Phase 1: åŸºç¡€æ¶æ„ (é¢„è®¡ 2-3 å¤©)
- [ ] åˆ›å»º `ItemReplacePage.tsx` ä¸»é¡µé¢
- [ ] è®¾è®¡é¡µé¢å¸ƒå±€å’Œæ ·å¼
- [ ] å®ç°å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½
- [ ] åˆ›å»ºè·¯ç”±å’Œå¯¼èˆª

### Phase 2: ç”»å¸ƒåŠŸèƒ½ (é¢„è®¡ 2-3 å¤©)
- [ ] é›†æˆç”»å¸ƒåº“ï¼ˆFabric.js æˆ– React Konvaï¼‰
- [ ] å®ç°åŒºåŸŸé€‰æ‹©å·¥å…·
- [ ] å®ç°ç”»ç¬”å·¥å…·
- [ ] å®ç°æ©¡çš®æ“¦å·¥å…·
- [ ] åŒºåŸŸæ•°æ®åºåˆ—åŒ–

### Phase 3: AI é›†æˆ (é¢„è®¡ 3-4 å¤©)
- [ ] åˆ›å»º `/api/item-replace/generate` ç«¯ç‚¹
- [ ] é›†æˆ Vertex AI Vision API
- [ ] å®ç°å›¾åƒä¿®å¤ï¼ˆInpaintingï¼‰
- [ ] å®ç°ç”ŸæˆçŠ¶æ€è¿½è¸ª
- [ ] é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

### Phase 4: æ•°æ®åº“ (é¢„è®¡ 1-2 å¤©)
- [ ] åˆ›å»º `item_replace_history` è¡¨
- [ ] å®ç°å†å²è®°å½•ä¿å­˜
- [ ] å®ç°å†å²è®°å½•æŸ¥è¯¢
- [ ] å®ç°å›¾ç‰‡å­˜å‚¨ï¼ˆSupabase Storageï¼‰

### Phase 5: UI/UX ä¼˜åŒ– (é¢„è®¡ 2-3 å¤©)
- [ ] å‰åå¯¹æ¯”é¢„è§ˆ
- [ ] åŠ è½½åŠ¨ç”»å’Œè¿›åº¦æ¡
- [ ] å†å²è®°å½•å±•ç¤º
- [ ] å“åº”å¼è®¾è®¡
- [ ] é”™è¯¯æç¤ºä¼˜åŒ–

### Phase 6: æµ‹è¯• & éƒ¨ç½² (é¢„è®¡ 1-2 å¤©)
- [ ] åŠŸèƒ½æµ‹è¯•
- [ ] ä¿¡ç”¨ç‚¹æ‰£é™¤æµ‹è¯•
- [ ] æƒé™æ§åˆ¶æµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ

**æ€»é¢„è®¡å¼€å‘æ—¶é—´**: 11-17 å¤©

---

## ğŸ¯ æˆåŠŸæŒ‡æ ‡

### åŠŸèƒ½æŒ‡æ ‡
- [ ] ç”¨æˆ·å¯ä»¥æˆåŠŸä¸Šä¼ å›¾ç‰‡
- [ ] ç”¨æˆ·å¯ä»¥ç²¾ç¡®é€‰æ‹©æ›¿æ¢åŒºåŸŸ
- [ ] AI ç”Ÿæˆç»“æœå‡†ç¡®åº¦ > 80%
- [ ] ç”Ÿæˆæ—¶é—´ < 30 ç§’

### æ€§èƒ½æŒ‡æ ‡
- [ ] é¡µé¢åŠ è½½æ—¶é—´ < 2 ç§’
- [ ] å›¾ç‰‡ä¸Šä¼ å“åº” < 1 ç§’
- [ ] ç”»å¸ƒæ“ä½œæµç•…ï¼ˆ60fpsï¼‰

### ä¸šåŠ¡æŒ‡æ ‡
- [ ] åŠŸèƒ½ä½¿ç”¨ç‡ > 20%ï¼ˆPro+ ç”¨æˆ·ï¼‰
- [ ] ç”¨æˆ·æ»¡æ„åº¦ > 4.0/5.0
- [ ] ä¿¡ç”¨ç‚¹è½¬åŒ–ç‡æå‡

---

## ğŸ”„ Git å·¥ä½œæµç¨‹

### å¼€å‘æµç¨‹

```bash
# 1. ç¡®ä¿åœ¨ feature/item-replace åˆ†æ”¯
git checkout feature/item-replace

# 2. å¼€å‘åŠŸèƒ½å¹¶æäº¤
git add .
git commit -m "feat: implement upload functionality"

# 3. å®šæœŸæ¨é€åˆ°è¿œç¨‹
git push origin feature/item-replace

# 4. å¼€å‘å®Œæˆåï¼Œåˆå¹¶åˆ° public-beta
git checkout public-beta
git merge feature/item-replace

# 5. æµ‹è¯•é€šè¿‡åï¼Œæ¨é€åˆ°ä¸»åˆ†æ”¯
git push origin public-beta
```

### æäº¤è§„èŒƒ

ä½¿ç”¨è¯­ä¹‰åŒ–æäº¤ä¿¡æ¯ï¼š
- `feat:` - æ–°åŠŸèƒ½
- `fix:` - ä¿®å¤ bug
- `ui:` - UI/æ ·å¼æ›´æ–°
- `refactor:` - ä»£ç é‡æ„
- `test:` - æµ‹è¯•ç›¸å…³
- `docs:` - æ–‡æ¡£æ›´æ–°

---

## ğŸ“ ç›¸å…³èµ„æº

### å‚è€ƒå®ç°
- Photoshop å†…å®¹æ„ŸçŸ¥å¡«å……
- Canva é­”æœ¯æ©¡çš®æ“¦
- Runway ML Inpainting

### API æ–‡æ¡£
- [Vertex AI Vision API](https://cloud.google.com/vision/docs)
- [Fabric.js Documentation](http://fabricjs.com/docs/)
- [Supabase Storage Guide](https://supabase.com/docs/guides/storage)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
# åˆ‡æ¢åˆ°åŠŸèƒ½åˆ†æ”¯
git checkout feature/item-replace

# å®‰è£…å¯èƒ½éœ€è¦çš„ä¾èµ–
npm install fabric
npm install react-konva konva

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# å¼€å§‹å¼€å‘ï¼
```

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. âœ… åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ - å®Œæˆ
2. â³ éœ€æ±‚ç»†åŒ–å’Œè®¾è®¡è¯„å®¡
3. â³ UI/UX åŸå‹è®¾è®¡
4. â³ æŠ€æœ¯æ–¹æ¡ˆè¯„å®¡
5. â³ å¼€å§‹ Phase 1 å¼€å‘

---

**åˆ†æ”¯çŠ¶æ€**: âœ… å·²åˆ›å»º  
**å‡†å¤‡å¼€å§‹å¼€å‘**: ç­‰å¾…éœ€æ±‚ç¡®è®¤  
**é¢„è®¡å®Œæˆæ—¶é—´**: 2-3 å‘¨  

---

## ğŸ’¬ è®¨è®ºè¦ç‚¹

åœ¨å¼€å§‹å¼€å‘å‰ï¼Œéœ€è¦ç¡®è®¤ï¼š

1. **åŠŸèƒ½èŒƒå›´**
   - æ˜¯å¦æ”¯æŒå¤šç‰©å“åŒæ—¶æ›¿æ¢ï¼Ÿ
   - æ˜¯å¦éœ€è¦ AI è‡ªåŠ¨è¯†åˆ«ç‰©å“ï¼Ÿ
   - æ˜¯å¦æ”¯æŒè‡ªå®šä¹‰æ ·å¼é¢„è®¾ï¼Ÿ

2. **æŠ€æœ¯é€‰å‹**
   - ä½¿ç”¨ Fabric.js è¿˜æ˜¯ React Konvaï¼Ÿ
   - ä½¿ç”¨ Vertex AI è¿˜æ˜¯å…¶ä»– AI æœåŠ¡ï¼Ÿ
   - å›¾ç‰‡å­˜å‚¨ç­–ç•¥ï¼Ÿ

3. **å®šä»·ç­–ç•¥**
   - ä¿¡ç”¨ç‚¹æ¶ˆè€—å¦‚ä½•å®šä»·ï¼Ÿ
   - æ˜¯å¦æä¾›å…è´¹è¯•ç”¨ï¼Ÿ
   - ä¼šå‘˜æŠ˜æ‰£æ¯”ä¾‹ï¼Ÿ

---

**å‡†å¤‡å°±ç»ªï¼Œç­‰å¾…å¼€å§‹å¼€å‘ï¼** ğŸ‰

